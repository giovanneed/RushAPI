<html> 
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<script type="text/javascript" src="javascript/javascript/jquery-1.4.3.min.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<!--script type="text/javascript" src="dump/dump.js"></script-->
<style type="text/css"> 

html { 
	height: 100% 
}

body {
	height: 100%;
	margin: 0px;
	padding: 0px;
	background-color: #ffffff;
}

#map_canvas {
	width: 100%;
	height: 100%;
}

div#map {
	position: relative;
}

/*
#places {
	position: absolute;
	top: 0;
	z-index:999;
	width:100%;
	height:200px;
}
*/

#routes {
	position: absolute;
	top: 0;
	right: 50%;
	z-index:999;
}

/* Top */
/* SLIDING PANEL STYLES */
#places {
	height: 300px;
	width: 900px;
	display: none;
	background-color: #000000;
	border-bottom-width: 2px;
	border-bottom-style: solid;
	border-bottom-color: #626262;
	opacity: .8;
	margin: auto;
	position: absolute;
	z-index: 9999;
}


.slide {
	margin: 0;
	padding: 0;
	background-image: url(images/layout/slide_button.png);
	background-repeat: no-repeat;
	background-position: center top;
}

.btn-slide {
	text-align: center;
	width: 191px;
	height: 26px;
	display: block;
	color: #fff;
	text-decoration: none;
	font-family: Arial, Helvetica, sans-serif;
	font-weight: bold;
	font-size: 1em;
	margin-right: auto;
	margin-left: auto;
	line-height: 22px;
}

</style>
<script type="text/javascript">
	$(document).ready(function(){
		$(".btn-slide").click(function(){
			$("#places").slideToggle("slow");
		});
	});

	var map;
	var bounds;
	var geocoder;
	var markers = [];
	var directionDisplay;
	var directionsService;
	var reverseGeocodedLast;
	var currentReverseGeocodeResponse;

	function initialize() {
		var latlng = new google.maps.LatLng(-19.815730, -43.954222);
		var myOptions = {
			zoom: 12,
			center: latlng,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};

		map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		geocoder = new google.maps.Geocoder();

		var rendererOptions = {
			draggable: true
		};
		
		directionsService = new google.maps.DirectionsService();
		directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
		bounds = new google.maps.LatLngBounds();
		
		directionsDisplay.setMap(map);
	}

	/* Select event handler */
	var flag = true;
	function resetIndex(selObj) {
		if(flag) selObj.selectedIndex = -1;
		flag = true;
	}
	
	function centerMap(selObj, type) {
		//alert(selObj.value);
		//var coordinates = selObj.value.replace(/,/g, ".").split(';');
		//alert(coordinates[0] +' - '+ coordinates[1]);
		flag = false;
        //var location = new google.maps.LatLng(coordinates[0], coordinates[1]); //lat, long
		var location = getLatLong(selObj.value);
		//alert(location);
        map.setCenter(location);
		addMarkerAtCenter();
		
		if(markers.lenght == 2) {
			bounds.extend(new google.maps.LatLng(markers[0], markers[1]));
			map.fitBounds(bounds);
		}
	}
	
	function getCenterLatLngText() {
		return '(' + map.getCenter().lat() +', '+ map.getCenter().lng() +')';
	}
	
	function addMarkerAtCenter() {
		var marker = new google.maps.Marker({
			position: map.getCenter(),
			map: map
		});

		var text = 'Lat/Lng: ' + getCenterLatLngText();

		var infowindow = new google.maps.InfoWindow({ content: text });

		google.maps.event.addListener(marker, 'click', function() {
			infowindow.open(map,marker);
		});
		
		if(markers.lenght == 2)
			clearMarkers();
		
		markers.push(marker);
	}
	
	/* Clear Markers */
	function clearMarkers() {
		// clear all markers
		$(markers).each(function () {
			 this.setMap(null);
		});

		// reset the eviction array 
		markers = [];
	}
	
	function clearFieldsMarkers() {
		// clear all markers
		$(fieldsMarkers).each(function () {
			 this.setMap(null);
		});

		// reset the eviction array 
		fieldsMarkers = [];
	}
	
	
	function getLatLong(value) {
		var coordinates = value.replace(/,/g, ".").split(';');
		var latitude = coordinates[0];
		var longitude = coordinates[1];
		return new google.maps.LatLng(latitude, longitude)
	}
	
	/* Calc route */
	function calcRoute(way) {
		if(way == 'leftToRight') {
			var start = getLatLong(document.getElementById("hotels_list").value);
			var end = getLatLong(document.getElementById("fields_list").value);
		} else { // if(way == 'rightToLeft')
			var start = getLatLong(document.getElementById("fields_list").value);
			var end = getLatLong(document.getElementById("hotels_list").value);
		}
		/*
		else {
			alert('Por favor selectione uma origem e um destino.');
		}
		*/
		//var waypts = [];
		//var checkboxArray = document.getElementById("waypoints");
		/*
		for (var i = 0; i < checkboxArray.length; i++) {
			if (checkboxArray.options[i].selected == true) {
				waypts.push({
					location:checkboxArray[i].value,
					stopover:true});
				}
		}
		*/

		var request = {
			origin: start, 
			destination: end,
			/*waypoints: waypts,*/
			optimizeWaypoints: true,
			travelMode: google.maps.DirectionsTravelMode.DRIVING
		};
		
		directionsService.route(request, function(response, status) {
			if (status == google.maps.DirectionsStatus.OK) {
				clearMarkers();
				directionsDisplay.setDirections(response);
				var route = response.routes[0];
				var summaryPanel = document.getElementById("directions");
				summaryPanel.innerHTML = "";
				summaryPanel.innerHTML += "<p>Distância Total: <span id=\"total\">" +computeTotalDistance(directionsDisplay.directions)+ "</span></p>";
				// For each route, display summary information.
				for (var i = 0; i < route.legs.length; i++) {
					var routeSegment = i + 1;
					summaryPanel.innerHTML += "<b>Trechos da rota: " + routeSegment + "</b><br />";
					summaryPanel.innerHTML += route.legs[i].start_address + " to ";
					summaryPanel.innerHTML += route.legs[i].end_address + "<br />";
					summaryPanel.innerHTML += route.legs[i].distance.text + "<br /><br />";
				}
			}
		});
		
		//computeTotalDistance(directionsDisplay.directions);
	}
	
	/* Calculate Distance */
	function computeTotalDistance(result) {
		var total = 0;
		var myroute = result.routes[0];
		for (i = 0; i < myroute.legs.length; i++) {
			total += myroute.legs[i].distance.value;
		}
		total = total / 1000.
		//document.getElementById("total").innerHTML = total + " km";
		return total + " km";
	} 
	
</script>
</head>
<body onload="initialize()">
	<div id="header" style="float: left;">
	<div id="places" style="display: block;">
		<div id="hotels">
			<label for="hotels_list">Hoteis</label>
			<select name="hotels" id="hotels_list" multiple="multiple" onchange="centerMap(this, 'hotel')" onclick="resetIndex(this)">
				<option name="hotels_latlong" value="-19,913996;-43,937427">Hotel 1 - Centro</option>
				<option name="hotels_latlong" value="-19,879090;-43,977499">Hotel 2 - São Luiz</option> <!-- style="background-image: url('images/icons/4stars.gif');" -->
				<option name="hotels_latlong" value="-19,930024;-43,947327">Hotel 3 - Centro</option>
				<option name="hotels_latlong" value="-19,964798;-43,955263">Hotel 4 - Belvedere</option>
			</select>
		</div>
		<div id="direction">
			<img src="images/icons/right-arrow.gif" alt="Rota do Hotel para Centro de Treinamento" onclick="calcRoute('leftToRight')" />
			<img src="images/icons/left-arrow.gif" alt="Rota do Centro de Treinamento para o Hotel" onclick="calcRoute('rightToLeft')" />
		</div>
		<div id="fields">
			<label for="fields_latlong">Centros de Treinamento</label>
			<select name="fields" id="fields_list" multiple="multiple" onchange="centerMap(this, 'fields')" onclick="resetIndex(this)">
				<option name="fields_latlong" value="-19,743358;-43,956835">Cidade do Galo</option>
				<option name="fields_latlong" value="-19,861291;-43,996725" >Toca da Raposa I</option>
				<option name="fields_latlong" value="-19,833762;-44,004836" >Toca da Raposa II</option>
				<option name="fields_latlong" value="-19,854742;-44,013526" >América - CT Lanna Drumond</option>
				<option name="fields_latlong" value="-19,852986;-43,951954" >Jaraguá Country Clube</option>
				<option name="fields_latlong" value="-20,160700;-43,957243" >Minas Tênis Náutico Clube</option>
				<option name="fields_latlong" value="-19,924305;-43,991532" >PUC - Coração Eucarístico</option>
			</select>
		</div>
		<p class="slide"><a href="#" class="btn-slide">Rotas</a></p> 
	</div>
	</div>
	<div id="map"> 
		<div id="map_canvas"></div>
		<div id="directions"></div>
	</div>
	<!--table id="info" style="position:absolute; bottom: 0; width:400px; height:100px"> 
		<tr><td>Lat/Lng:</td><td><div id="latlng"></div></td></tr> 
		<tr><td>Endereço:</td><td><div id="formatedAddress"></div></td></tr> 
		<tr><td>Nível de Zoom</td><td><div id="zoom_level">2</div></td></tr> 
	</table-->
</body> 
</html>